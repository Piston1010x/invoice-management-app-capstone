<!-- templates/admin/dashboard.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard</title>
  <!-- Bootstrap 5 + Icons -->
  <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
  <link
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
          rel="stylesheet">
  <style>
    .stat-card .bi { font-size: 2.5rem; }

    /* ─── custom status badge colors ─── */
    .badge-DRAFT   { background: #6c757d; color: #fff; }
    .badge-SENT    { background: #0d6efd; color: #fff; }
    .badge-PAID    { background: #198754; color: #fff; }
    .badge-OVERDUE { background: #dc3545; color: #fff; }
  </style>
</head>
<body class="p-4">
<!-- top nav -->
<div th:replace="fragments/navbar :: body"></div>

<h1 class="mb-4">Dashboard</h1>

<!-- Date Range Filter -->
<form class="row g-2 mb-5" method="get" th:action="@{/admin/dashboard}">
  <div class="col-auto">
    <input type="date" name="from" class="form-control" th:value="${from}" />
  </div>
  <div class="col-auto">
    <input type="date" name="to" class="form-control" th:value="${to}" />
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-primary">Apply</button>
  </div>
</form>

<!-- KPI CARDS -->
<div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4 mb-5">
  <!-- Total Invoices -->
  <div class="col">
    <div class="card stat-card h-100 text-center shadow-sm">
      <div class="card-body d-flex flex-column justify-content-center">
        <i class="bi bi-receipt text-primary mb-2"></i>
        <h2 th:text="${stats.totalInvoices}" class="mb-1">0</h2>
        <p class="text-muted mb-0">Total Invoices</p>
      </div>
    </div>
  </div>
  <!-- Paid -->
  <div class="col">
    <div class="card stat-card h-100 text-center shadow-sm">
      <div class="card-body d-flex flex-column justify-content-center">
        <i class="bi bi-currency-dollar text-success mb-2"></i>
        <h2 th:text="${stats.paid}" class="mb-1">0</h2>
        <p class="text-muted mb-0">Paid</p>
      </div>
    </div>
  </div>
  <!-- Pending -->
  <div class="col">
    <div class="card stat-card h-100 text-center shadow-sm">
      <div class="card-body d-flex flex-column justify-content-center">
        <i class="bi bi-hourglass-split text-primary mb-2"></i>
        <h2 th:text="${stats.sent}" class="mb-1">0</h2>
        <p class="text-muted mb-0">Pending</p>
      </div>
    </div>
  </div>
  <!-- Overdue -->
  <div class="col">
    <div class="card stat-card h-100 text-center shadow-sm">
      <div class="card-body d-flex flex-column justify-content-center">
        <i class="bi bi-exclamation-circle text-warning mb-2"></i>
        <h2 th:text="${stats.overdue}" class="mb-1">0</h2>
        <p class="text-muted mb-0">Overdue</p>
      </div>
    </div>
  </div>
</div>

<!-- MONEY CARDS -->
<div class="row row-cols-1 row-cols-md-2 g-4 mb-5">
  <div class="col">
    <div class="card h-100 shadow-sm text-center">
      <div class="card-body d-flex flex-column justify-content-center">
        <i class="bi bi-wallet2 text-success mb-2"></i>
        <h3 class="mb-1"
            th:text="'$ ' + ${#numbers.formatDecimal(stats.revenue,1,'COMMA',2,'POINT')}">
          $0.00
        </h3>
        <p class="text-muted mb-0">Revenue (Paid)</p>
      </div>
    </div>
  </div>
  <div class="col">
    <div class="card h-100 shadow-sm text-center">
      <div class="card-body d-flex flex-column justify-content-center">
        <i class="bi bi-credit-card text-danger mb-2"></i>
        <h3 class="mb-1"
            th:text="'$ ' + ${#numbers.formatDecimal(stats.outstanding,1,'COMMA',2,'POINT')}">
          $0.00
        </h3>
        <p class="text-muted mb-0">Outstanding</p>
      </div>
    </div>
  </div>
</div>

<!-- CHARTS -->
<div class="row row-cols-1 row-cols-md-2 g-4 mb-5" id="charts-row">
  <!-- Status Doughnut -->
  <div class="col">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-title text-center">Status Breakdown</h6>
        <div class="ratio ratio-4x3">
          <canvas id="statusChart"></canvas>
        </div>
      </div>
    </div>
  </div>
  <!-- Revenue vs Outstanding Bar -->
  <div class="col">
    <div class="card shadow-sm">
      <div class="card-body">
        <h6 class="card-title text-center">Revenue vs. Outstanding</h6>
        <div class="ratio ratio-4x3">
          <canvas id="financeChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- RECENT INVOICES -->
<h2 class="h5 mb-3">Recent Invoices</h2>
<div class="table-responsive mb-5">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-light">
    <tr>
      <th>#</th><th>Client</th><th>Status</th><th class="text-end">Total</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="inv : ${recentInvoices}">
      <td th:text="${inv.invoiceNumber}">INV-00002</td>
      <td th:text="${inv.clientName}">Acme Ltd</td>
      <td>
            <span class="badge"
                  th:classappend="'badge-'+${inv.status}"
                  th:text="${inv.status}">DRAFT</span>
      </td>
      <td class="text-end" th:text="${inv.total}">50.00</td>
    </tr>
    <tr th:if="${#lists.isEmpty(recentInvoices)}">
      <td colspan="4" class="text-center text-muted">No recent invoices</td>
    </tr>
    </tbody>
  </table>
</div>

<!-- Bootstrap & Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script th:inline="javascript">
  /*<![CDATA[*/
  // Status Doughnut
  new Chart(document.getElementById('statusChart'), {
    type: 'doughnut',
    data: {
      labels: ['Draft','Sent','Overdue','Paid'],
      datasets: [{
        data: [
          /*[[${stats.draft}]]*/,
          /*[[${stats.sent}]]*/,
          /*[[${stats.overdue}]]*/,
          /*[[${stats.paid}]]*/
        ],
        backgroundColor: ['#6c757d','#0d6efd','#dc3545','#198754']
      }]
    },
    options: { plugins: { legend: { position: 'bottom' } } }
  });

  // Finance Bar Chart
  new Chart(document.getElementById('financeChart'), {
    type: 'bar',
    data: {
      labels: ['Revenue','Outstanding'],
      datasets: [{
        label: 'Amount ($)',
        data: [
          /*[[${stats.revenue}]]*/,
          /*[[${stats.outstanding}]]*/
        ],
        backgroundColor: ['#198754','#dc3545'],
        borderWidth: 1
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { callback: function(value) { return '$' + value; } }
        }
      }
    }
  });
  /*]]>*/
</script>
</body>
</html>
