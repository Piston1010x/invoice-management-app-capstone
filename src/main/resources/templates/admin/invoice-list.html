<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <title>Invoices</title>
  <style>
    .badge-DRAFT   { background:#6c757d; } /* grey */
    .badge-SENT    { background:#0d6efd; }
    .badge-PAID    { background:#198754; }
    .badge-OVERDUE { background:#dc3545; }

    .scroll-table-wrapper {
      max-height: 500px;
      overflow-y: auto;
      border: 1px solid #dee2e6;
      border-radius: 0.375rem;
    }

    thead th {
      position: sticky;
      top: 0;
      background-color: #f8f9fa;
      z-index: 2;
    }
  </style>
</head>
<body class="p-4">
<div th:replace="fragments/navbar :: body"></div>

<h1 class="mb-3">Invoices</h1>

<div th:if="${success}" class="alert alert-success" th:text="${success}"></div>

<div class="scroll-table-wrapper">
  <table class="table table-hover align-middle mb-0">
    <thead class="table-light">
    <tr>
      <th>#</th>
      <th>Client</th>
      <th class="text-end">Total</th>
      <th>Status</th>
      <th>Issued</th>
      <th>Due</th>
      <th class="text-end">Actions</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="inv : ${invoices}">
      <td th:text="${inv.invoiceNumber}">INV‑00001</td>
      <td th:text="${inv.clientName}">Acme Ltd</td>
      <td class="text-end" th:text="${inv.total}">100.00</td>

      <td>
        <span class="badge"
              th:text="${inv.status}"
              th:classappend="'badge-'+${inv.status}">
          DRAFT
        </span>
      </td>

      <td th:text="${inv.issueDate} ?: '-'">‑</td>
      <td th:text="${inv.dueDate}">‑</td>

      <td class="text-end">
        <form th:action="@{|/admin/invoices/${inv.id}/send|}"
              method="post" style="display:inline"
              th:if="${inv.status.name() == 'DRAFT'}">
          <button class="btn btn-sm btn-primary">Send</button>
        </form>

        <form th:action="@{|/admin/invoices/${inv.id}/mark-paid|}"
              method="post" style="display:inline"
              th:if="${inv.status.name() == 'SENT' or inv.status.name() == 'OVERDUE'}">
          <button class="btn btn-sm btn-success">Mark Paid</button>
        </form>

        <a th:href="@{|/api/v1/invoices/${inv.id}|}" target="_blank"
           class="btn btn-sm btn-outline-secondary">View JSON</a>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<a href="/admin/invoices/new"
   class="btn btn-primary rounded-circle"
   style="position:fixed;bottom:2rem;right:2rem;width:60px;height:60px;
          display:flex;align-items:center;justify-content:center;font-size:1.5rem;">
  +
</a>
</body>
</html>
