<!-- templates/admin/invoice-list.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Invoices</title>
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    .badge-DRAFT   { background:#6c757d }
    .badge-SENT    { background:#0d6efd }
    .badge-PAID    { background:#198754 }
    .badge-OVERDUE { background:#dc3545 }
    /* keeps table neat */
    #table-wrapper{max-height:65vh;overflow-y:auto}
  </style>
</head>
<body class="p-4">
<div th:replace="fragments/navbar :: body"></div>

<h1 class="mb-3">Invoices</h1>
<div th:if="${success}" class="alert alert-success" th:text="${success}"></div>

<!-- ========= Filter pills ========= -->
<div class="btn-group mb-3">
  <a th:href="@{/admin/invoices}"                class="btn btn-sm"
     th:classappend="${filter==null} ? 'btn-primary' : 'btn-outline-primary'">All</a>
  <a th:each="st : ${T(com.invoiceapp.entity.InvoiceStatus).values()}"
     th:href="@{/admin/invoices(status=${st.name()})}"
     th:text="${st.name()}"
     class="btn btn-sm"
     th:classappend="${filter?.name()==st.name()} ? 'btn-primary' : 'btn-outline-primary'"></a>
</div>

<!-- ========= Table ========= -->
<div id="table-wrapper" class="table-responsive">
  <table class="table table-hover align-middle">
    <thead class="table-light">
    <tr>
      <th>#</th><th>Client</th>
      <th class="text-end">Total</th>
      <th>Status</th><th>Issued</th><th>Due</th>
      <th class="text-end">Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="inv : ${invoices}">
      <td th:text="${inv.invoiceNumber}">INV-00001</td>
      <td th:text="${inv.clientName}">Acme Ltd</td>
      <td class="text-end" th:text="${inv.total}">100.00</td>

      <td><span class="badge"
                th:classappend="'badge-'+${inv.status}"
                th:text="${inv.status}">DRAFT</span></td>

      <td th:text="${inv.issueDate} ?: '-'">-</td>
      <td th:text="${inv.dueDate}">-</td>

      <td class="text-end">
        <!-- Send -->
        <form th:action="@{|/admin/invoices/${inv.id}/send|}"
              method="post" style="display:inline"
              th:if="${inv.status.name() == 'DRAFT'}">
          <button class="btn btn-sm btn-primary">Send</button>
        </form>

        <!-- Mark-paid -->
        <form th:action="@{|/admin/invoices/${inv.id}/mark-paid|}"
              method="post" style="display:inline"
              th:if="${inv.status.name()=='SENT' || inv.status.name()=='OVERDUE'}">
          <button class="btn btn-sm btn-success">Paid</button>
        </form>

        <!-- Download PDF -->
        <a th:href="@{|/admin/invoices/${inv.id}/pdf|}"
           class="btn btn-sm btn-outline-secondary"
           title="Download PDF" target="_blank">PDF</a>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<!-- Floating + button -->
<a href="/admin/invoices/new"
   class="btn btn-primary rounded-circle"
   style="position:fixed;bottom:2rem;right:2rem;width:60px;height:60px;
          display:flex;align-items:center;justify-content:center;font-size:1.5rem;">+</a>
</body>
</html>
